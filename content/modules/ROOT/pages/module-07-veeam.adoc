= Disaster Recovery for Virtual Machines with Kasten K10

== Introduction

In this workshop, we've explored performance, networking, and high availability. But *availability* (keeping the service online) is different from *data protection* (keeping the data safe). What happens if an administrator accidentally deletes the *entire project*? Or if data inside a VM becomes corrupted and you need to roll back to yesterday's copy?

This is where Disaster Recovery (DR) and backup solutions become critical. OpenShift Virtualization workloads are complex, consisting of a VirtualMachine definition, a DataVolume, a PersistentVolumeClaim (PVC), and the underlying data. We need a solution that understands and can back up all these components as a single, consistent application.

In this final module, you will learn how to use **Kasten K10 by Veeam**, a leading Kubernetes data protection platform, to back up and restore an entire Virtual Machine application. You will create a VM with unique data, back it up, simulate a total disaster by deleting the project, and then restore the VM and its data from scratch.

== Credentials for the Red Hat OpenShift Console

Your OpenShift cluster console is available {openshift_cluster_console_url}[here^].

Your local admin login is available with the following credentials:

* *User:* `{openshift_cluster_admin_username}`
* *Password:* `{openshift_cluster_admin_password}`

You will first see a page that asks you to choose an authentication provider, click on *htpasswd_provider*.

image::module-05-kasten/00-htpasswd_login.png[title="OpenShift Authentication", link=self, window=blank, width=100%]

You will then be presented with a login screen where you can copy/paste your credentials.

image::module-05-kasten/01-openshift_login.png[title="OpenShift Login", link=self, window=blank, width=100%]

[[access-kasten]]
== Accessing the Kasten K10 Dashboard

First, let's log in to the Kasten K10 dashboard, which is running as an application on our OpenShift cluster.

. In the *Administrator* perspective of the OpenShift console, use the *Project* dropdown to select the `kasten-io` project.
. In the left navigation menu, click on *Networking* -> *Routes*.
. You will see a Route named `k10-dashboard`. Click on the URL in the *Location* column.
+
image::module-05-kasten/02-kasten-route.png[title="Kasten Dashboard Route", link=self, window=blank, width=100%]
+
. A new tab will open. Kasten is integrated with OpenShift's authentication. Click the **Log in with OpenShift** button.
+
image::module-05-kasten/03-kasten-login.png[title="Kasten Login Screen", link=self, window=blank, width=100%]
+
. You will be asked to authorize the Kasten service account. Click *Allow selected permissions*.
. You are now at the main Kasten K10 Dashboard. This is your command center for all backup and restore operations.
+
image::module-05-kasten/04-kasten-dashboard.png[title="Kasten K10 Dashboard", link=self, window=blank, width=100%]

[[create-vm-dr]]
== Create and Populate the Target VM

We need a VM with some "critical data" to back up.

. Back in the OpenShift console, create a new project. Click *Projects* -> *Create Project*.
. *Name:* `dr-test`
. Click *Create*.
. Switch to the *Virtualization* perspective.
. Go to *Virtualization* -> *VirtualMachines* and make sure the `dr-test` project is selected.
. Create a new VM:
    * *Name:* `critical-db-vm`
    * *Operating System:* Select a *Fedora* image.
    * *Flavor:* `tiny`
. Click *Create VirtualMachine* and wait for it to start and enter the *Running* state.
. Once running, click on `critical-db-vm` and go to the *Console* tab.
. Log in to the VM (e.g., user `fedora`, no password).
. Now, let's create our "critical data" file. This file is our proof that the data itself is being backed up.
+
[source,sh,role=execute]
----
echo "My Secret Database Password" > /home/fedora/secret-file.txt
----
+
. Verify the file was created.
+
[source,sh,role=execute]
----
cat /home/fedora/secret-file.txt
----
+
. You should see the output `My Secret Database Password`.
. You can now log out of the console. Our VM is running and contains unique data.

[[create-backup-policy]]
== Create a Backup Policy in Kasten

Now, let's instruct Kasten to back up our new `dr-test` application.

. Switch back to your Kasten K10 Dashboard browser tab.
. Click on *Applications* in the left menu. Kasten automatically discovers applications (namespaces).
. You should see `dr-test` in the list. Click on it.
+
image::module-05-kasten/05-kasten-apps-list.png[title="Kasten Applications", link=self, window=blank, width=100%]
+
. The dashboard will show all the resources in this namespace, including our VM and its DataVolume.
. Click the *Create a Policy* button.
. Fill out the form:
    * *Name:* `dr-test-daily-backup`
    * *Action:* `Backup` (this is the default).
    * *Backup Frequency:* `Daily` (Kasten will automatically select a time).
    * *Location Profile:* A backup location (e.g., `s3-storage-profile`) should already be configured for you.
. Click *Create Policy*.

[[run-backup]]
== Run the Backup Manually

The policy is set to run daily, but we want a backup *now*.

. You will be on the *Policies* page. Find your `dr-test-daily-backup` policy.
. Click the *Run Once* button (the "play" icon) on the far right of its row.
. A dialog will pop up. Click the *Run* button.
+
image::module-05-kasten/06-kasten-run-policy.png[title="Run Kasten Policy", link=self, window=blank, width=100%]
+
. Go to the main *Dashboard* by clicking the Kasten logo in the top left.
. You will see your backup job running in the *Activity* panel.
. Wait for the `Backup` job to show the status *Succeeded*. This may take a few minutes as it copies the VM's disk data (a snapshot) to the S3 backup location.
+
image::module-05-kasten/07-kasten-backup-succeeded.png[title="Kasten Backup Succeeded", link=self, window=blank, width=100%]
+
. We now have a secure, application-consistent backup of our VM and its data, stored *externally* from the cluster.

[[simulate-disaster]]
== Simulate a Total Disaster

Now, let's perform the ultimate "oops" and delete the *entire project*.

. Return to the *OpenShift Console* tab.
. Switch to the *Administrator* perspective.
. Go to *Home* -> *Projects*.
. Find the `dr-test` project.
. Click the *Kebab menu (⋮)* on the far right of its row, and select *Delete Project*.
+
image::module-05-kasten/08-openshift-delete-project.png[title="Delete Project", link=self, window=blank, width=100%]
+
. A confirmation box will appear. Type `dr-test` to confirm.
. Click *Delete*.
. The project will change to `Terminating` and then disappear from the list.
. Our VM, its disk (PVC), its console, and our "secret file" are all *gone*.

[[restore-vm]]
== Restore the Application from Backup

Time to see if Kasten can save the day.

. Go back to the *Kasten K10 Dashboard*.
. Click on *Applications* in the left menu.
. The `dr-test` application will still be listed, but will have a *Removed* status.
. Click on `dr-test`.
. You will see a list of *Restore Points*. We have the one we just created.
. Click the *Restore* icon on the right of that restore point.
+
image::module-05-kasten/09-kasten-restore-point.png[title="Kasten Restore Point", link=self, window=blank, width=100%]
+
. The *Restore Application* dialog will appear.
. We want to restore everything to its original place. Kasten is smart enough to know it needs to re-create the `dr-test` namespace.
. Leave all defaults and click the *Restore* button at the bottom.
+
image::module-05-kasten/10-kasten-restore-dialog.png[title="Kasten Restore Dialog", link=self, window=blank, width=100%]
+
. You will be taken to the *Dashboard*, where you can see the `Restore` job in the *Activity* panel.
. Wait for the job to show the status *Succeeded*.

[[verify-restore]]
== Verify the VM and its Data

The Kasten dashboard says the restore is complete. Let's verify.

. Go back to the *OpenShift Console*.
. Go to *Home* -> *Projects*.
. Look! The `dr-test` project has reappeared!
. Click on the `dr-test` project.
. Switch to the *Virtualization* perspective.
. Go to *Virtualization* -> *VirtualMachines*.
. You will see `critical-db-vm` is back and in the *Running* state.
. But is the *data* there? This is the most important test.
. Click on `critical-db-vm` and open the *Console* tab.
. Log in to the VM (`fedora`).
. Run the `cat` command again to check for our file:
+
[source,sh,role=execute]
----
cat /home/fedora/secret-file.txt
----
+
. The console will output:
+
[source,sh]
----
My Secret Database Password
----
+
Our VM, its disk, and its critical data have all been fully restored from backup.

== Workshop Summary

In this module, you learned how to provide true data protection and disaster recovery for your OpenShift Virtualization workloads. You used Kasten K10 to create an application-aware backup of a Virtual Machine, including its persistent data. You then simulated a catastrophic project deletion and successfully restored the *entire application*—the project, the VM, and its data—from an external backup, proving the system's resilience.

Congratulations! You have completed the OpenShift Virtualization workshop. You have journeyed from basic VM creation to advanced networking with VLANs, high availability with load balancers, automated node-failure remediation, and finally, complete disaster recovery. You are now well-equipped to run modern and traditional workloads side-by-side on the OpenShift platform.